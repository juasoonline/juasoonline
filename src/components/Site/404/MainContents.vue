<template>

    <!-- Begin contents -->
    <main class="container mx-auto my-4">

        <!-- Begin image contents -->
<<<<<<< HEAD
        <div class="text-center mx-auto mt-32">

            <!-- Begin icon -->
            <div class="mb-6">
                <svg class="w-24 mx-auto" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 511 511" enable-background="new 0 0 511 511">
                    <g>
                        <path d="m399.5,192h-32c-5.647,0-11.161,0.742-16.5,2.177v-34.677c0-8.547-6.953-15.5-15.5-15.5h-272c-8.547,0-15.5,6.953-15.5,15.5v280c0,19.43 14.106,35.617 32.613,38.887 3.27,18.506 19.457,32.613 38.887,32.613h160c19.43,0 35.617-14.107 38.887-32.613 18.507-3.27 32.613-19.457 32.613-38.887v-26.678c5.339,1.436 10.854,2.178 16.5,2.178h32c35.014,0 63.5-28.486 63.5-63.5v-96c0-35.014-28.486-63.5-63.5-63.5zm-48.5,63.5c0-9.098 7.402-16.5 16.5-16.5h32c9.098,0 16.5,7.402 16.5,16.5v96c0,9.098-7.402,16.5-16.5,16.5h-32c-9.098,0-16.5-7.402-16.5-16.5v-96zm-71.5,240.5h-160c-10.894,0-20.146-7.149-23.321-17h206.643c-3.176,9.851-12.428,17-23.322,17zm56.5-56.5c0,13.509-10.991,24.5-24.5,24.5h-224c-13.509,0-24.5-10.991-24.5-24.5v-280c0-0.276 0.224-0.5 0.5-0.5h272c0.276,0 0.5,0.224 0.5,0.5v280zm112-88c0,26.743-21.757,48.5-48.5,48.5h-32c-5.707,0-11.235-0.98-16.5-2.89v-18.792c4.802,2.965 10.454,4.681 16.5,4.681h32c17.369,0 31.5-14.131 31.5-31.5v-96c0-17.369-14.131-31.5-31.5-31.5h-32c-6.046,0-11.698,1.716-16.5,4.681v-18.792c5.264-1.91 10.792-2.889 16.5-2.889h32c26.743,0 48.5,21.757 48.5,48.5v96.001z"/>
                        <path d="m184,119.5c0,4.142 3.358,7.5 7.5,7.5s7.5-3.358 7.5-7.5c0-6.554 2.464-9.427 6.193-13.776 4.369-5.095 9.807-11.436 9.807-23.541 0-12.109-5.437-18.454-9.805-23.551-3.73-4.353-6.195-7.229-6.195-13.791s2.464-9.438 6.195-13.791c4.368-5.096 9.805-11.441 9.805-23.55 0-4.142-3.358-7.5-7.5-7.5s-7.5,3.358-7.5,7.5c0,6.562-2.464,9.438-6.195,13.791-4.368,5.097-9.805,11.441-9.805,23.551s5.437,18.454 9.805,23.551c3.73,4.353 6.195,7.229 6.195,13.791 0,6.554-2.464,9.427-6.193,13.776-4.369,5.095-9.807,11.436-9.807,23.54z"/>
                        <path d="m224,119.5c0,4.142 3.358,7.5 7.5,7.5s7.5-3.358 7.5-7.5c0-6.554 2.464-9.427 6.193-13.776 4.369-5.095 9.807-11.436 9.807-23.541 0-12.109-5.437-18.454-9.805-23.551-3.73-4.353-6.195-7.229-6.195-13.791 0-4.142-3.358-7.5-7.5-7.5s-7.5,3.358-7.5,7.5c0,12.109 5.437,18.454 9.805,23.551 3.73,4.353 6.195,7.229 6.195,13.791 0,6.554-2.464,9.427-6.193,13.776-4.369,5.096-9.807,11.437-9.807,23.541z"/>
                        <path d="m144,119.5c0,4.142 3.358,7.5 7.5,7.5s7.5-3.358 7.5-7.5c0-6.554 2.464-9.427 6.193-13.776 4.369-5.095 9.807-11.436 9.807-23.541 0-12.109-5.437-18.454-9.805-23.551-3.73-4.353-6.195-7.229-6.195-13.791 0-4.142-3.358-7.5-7.5-7.5s-7.5,3.358-7.5,7.5c0,12.109 5.437,18.454 9.805,23.551 3.73,4.353 6.195,7.229 6.195,13.791 0,6.554-2.464,9.427-6.193,13.776-4.369,5.096-9.807,11.437-9.807,23.541z"/>
                        <path d="m311.5,176c-4.142,0-7.5,3.358-7.5,7.5v24c0,4.142 3.358,7.5 7.5,7.5s7.5-3.358 7.5-7.5v-24c0-4.142-3.358-7.5-7.5-7.5z"/>
                        <path d="m311.5,232c-4.142,0-7.5,3.358-7.5,7.5v120c0,4.142 3.358,7.5 7.5,7.5s7.5-3.358 7.5-7.5v-120c0-4.142-3.358-7.5-7.5-7.5z"/>
                    </g>
                </svg>
            </div>
            <!-- End icon -->

            <!-- Begin text -->
            <div class="mb-4">
                <h1 class="text-4xl font-extrabold text-gray-700">We couldn't find the item</h1>
                <p>But we still have much more shopping items for you.</p>
            </div>
            <!-- End text -->

            <!-- Begin button -->
            <div class="mb-24">
                <router-link to="/" class="inline-flex focus:outline-none items-center px-16 py-2 border border-transparent rounded shadow-sm text-sm 2xl:font-bold text-white bg-red-500 hover:bg-red-400">Keep Shopping</router-link>
            </div>
            <!-- End button -->

            <!-- <img class="mt-20 mx-auto w-96" src="https://kyeiandamankwaa.com/juasoonline/resources/assets/images/404.png"> -->
=======
        <div class="text-center mx-auto">
            <img class="mt-20 mx-auto w-96" src="https://juasoonline.nyc3.digitaloceanspaces.com/assets/images/others/404.png" alt="">
>>>>>>> test
        </div>
        <!-- End image contents -->

        <!-- Begin items wrapper -->
        <div class="mx-auto mt-20">

            <!-- Begin items -->
            <div id="infinite-list" class="grid 2xl:gap-7 xl:gap-7 lg:gap-7 md:gap-2 sm:gap-2 xs:gap-1 2xl:grid-cols-6 xl:grid-cols-5 lg:grid-cols-4 md:grid-cols-3 sm:grid-cols-2 xs:grid-cols-2">
                <div v-for="item in product.items" :key="item.attributes.resource_id" class="card bg-white rounded overflow-hidden shadow-md hover:shadow-2xl">
                    <router-link class="w-full object-cover" :to="{ name: 'Item', params: { item: item.attributes.resource_id }}">
                        <img class="object-cover h-48 w-full" v-bind:src="item.attributes.image" :alt="item.attributes.image">
                    </router-link>
                    <div class="m-2">
                        <span class="text-gray-500 text-xs hover:text-red-500 leading-tight">
                            <router-link class="w-full object-cover" :to="{ name: 'Item', params: { item: item.attributes.resource_id } }">
                                <p class="leading-5" :title="item.attributes.name">{{ item.attributes.name.substring(0, 25) }}...</p>
                            </router-link>
                        </span>
                        <p v-if="item.pricing.priced === 'Product'" class="font-bold block text-xs my-0.5">
                            <router-link class="w-full object-cover text-gray-700 hover:text-red-500" :to="{ name: 'Item', params: { item: item.attributes.resource_id } }">
                                {{ item.pricing.price_data[0].sales_price }}
                                <del class="ml-2 text-xxxs font-light text-gray-500 text-red-500"> {{ item.pricing.price_data[0].price }}</del>
                            </router-link>
                        </p>
                        <p v-else class="font-bold block text-xs my-0.5">
                            <router-link class="w-full object-cover text-gray-700 hover:text-red-500" :to="{ name: 'Item', params: { item: item.attributes.resource_id } }">
                                {{ item.pricing.price_data[0].price_range }}
                            </router-link>
                        </p>
                        <span class="block text-gray-500 text-xxs">{{ item.attributes.total_sold }} Sold</span>
                    </div>
                </div>
            </div>
            <!-- End items -->

            <!-- Begin preloader -->
            <div v-if="isLoading">
<<<<<<< HEAD
                <img class="mx-auto text-center w-20 h-20" src="https://kyeiandamankwaa.com/juasoonline/resources/assets/images/others/loader.gif">
=======
                <img class="mx-auto text-center w-20 h-20" src="https://juasoonline.nyc3.digitaloceanspaces.com/assets/images/others/loader.gif" alt="">
>>>>>>> test
            </div>
            <!-- End preloader -->

        </div>
        <!-- End items wrapper -->

    </main>
    <!-- End contents -->

</template>

<script>
    import { computed, onBeforeMount, onMounted, onUnmounted, reactive, ref } from "vue";
    import axios from "axios";

    export default
    {
        name: "MainContents",
        setup ()
        {
            const product = reactive({ items: [] })
            const currentPage = ref(0)
            const totalPages = ref()
            const isInitialRequestLoading = ref(true)
            const isLoading = ref(false )

            const getItems = async () =>
            {
                currentPage.value++
                try
                {
                    const response = await axios({ method: 'GET', url: `business/products?page=${currentPage.value}`, headers: {} })
                    const parsedResponse = await response.data
                    product.items = [ ...product.items, ...parsedResponse.data ]
                    totalPages.value = parsedResponse.meta.last_page
                }
                catch( err )
                {
                    console.log( err )
                }
            }

            onBeforeMount(async () =>
            {
                await getItems()
                isInitialRequestLoading.value = false
            })

            const handleScroll = async () =>
            {
                if (( window.scrollY + window.innerHeight ) >= document.body.offsetHeight )
                {
                    if ( hasFetchedAllData.value || isLoading.value ) { return }
                    isLoading.value = true
                    await getItems()
                    isLoading.value = false
                }
            }

            onMounted(() => { window.addEventListener('scroll', handleScroll) })
            onUnmounted(() => { window.removeEventListener('scroll', handleScroll) })

            const hasFetchedAllData = computed(() =>
            {
                return currentPage.value === totalPages.value && !isLoading.value
            })

            return { product, isInitialRequestLoading, isLoading }
        }
    }
</script>

<style scoped>

</style>